import{u as g,o as n,ar as b,cr as m,bH as w,a as v,b9 as k,_ as x,aw as _,bf as F,n as j,as as L,f as c,Y as O}from"./index.bde27d78.js";import{a as W}from"./useUtil.e5c2b853.js";import{O as P}from"./icon.fc57cc73.js";import{H as S,a as z,A as B,V as C}from"./video_box.1204f4ae.js";import"./api.8071a577.js";import"./index.15317b0e.js";import"./index.e86b6ae7.js";import"./Layout.f2379779.js";import"./Markdown.1c1053f7.js";import"./index.b177cc60.js";import"./FolderTree.4ad558c7.js";const $=()=>{const{replace:h,pathname:d}=g(),{proxyLink:u}=W();let i=n.objs.filter(e=>e.type===P.VIDEO);i.length===0&&(i=[n.obj]);let o,s={id:d(),container:"#video-player",title:n.obj.name,volume:.5,autoplay:b("video_autoplay"),autoSize:!1,autoMini:!0,loop:!1,flip:!0,playbackRate:!0,aspectRatio:!0,setting:!0,hotkey:!0,pip:!0,mutex:!0,fullscreen:!0,fullscreenWeb:!0,subtitleOffset:!0,miniProgressBar:!1,playsInline:!0,quality:[],plugins:[],whitelist:[],moreVideoAttr:{"webkit-playsinline":!0,playsInline:!0},type:"m3u8",customType:{m3u8:function(e,t){const r=new S;r.loadSource(t),r.attachMedia(e),e.src||(e.src=t)}},lang:["en","zh-cn","zh-tw"].includes(m().toLowerCase())?m().toLowerCase():"en",lock:!0,fastForward:!0,autoPlayback:!0,autoOrientation:!0,airplay:!0};const l=n.related.find(e=>{for(const t of[".srt",".ass",".vtt"])if(e.name.endsWith(t))return!0;return!1}),f=n.related.find(e=>{for(const t of[".xml"])if(e.name.endsWith(t))return!0;return!1});l&&(s.subtitle={url:u(l,!0),type:w(l.name)}),f&&(s.plugins=[z({danmuku:u(f,!0),speed:5,opacity:1,fontSize:25,color:"#FFFFFF",mode:0,margin:[0,"0%"],antiOverlap:!1,useWorker:!0,synchronousPlayback:!1,lockTime:5,maxLength:100,minWidth:200,maxWidth:400,theme:"dark"})]);const[I,y]=v(()=>k.post("/fs/other",{path:d(),password:x(),method:"video_preview"}));return _(async()=>{const e=await y();F(e,t=>{const r=t.video_preview_play_info.live_transcoding_task_list.filter(a=>a.url);if(r.length===0){j.error("No transcoding video found");return}s.url=r[r.length-1].url,s.quality=r.map((a,p)=>({html:a.template_id,url:a.url,default:p===r.length-1})),o=new B(s),o.on("video:ended",()=>{const a=i.findIndex(p=>p.name===n.obj.name);a<i.length-1&&h(i[a+1].name)}),l&&o.on("video:play",a=>{o.subtitle.url=u(l,!0)})})}),L(()=>{o==null||o.destroy()}),c(C,{get children(){return c(O,{w:"$full",h:"60vh",id:"video-player"})}})};export{$ as default};
